{
  "info": {
    "name": "Parallel Workflow Testing - DEPLOYED",
    "description": "Comprehensive parallel workflow testing on deployed service (port 9090)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:9090/workflow/v3"
    },
    {
      "key": "tenantId",
      "value": "test-tenant"
    },
    {
      "key": "parallelProcessId",
      "value": "parallel-doc-process"
    },
    {
      "key": "appliedStateId",
      "value": "parallel-applied-state"
    },
    {
      "key": "parallelStateId",
      "value": "parallel-review-state"
    },
    {
      "key": "joinStateId",
      "value": "join-review-state"
    },
    {
      "key": "approvedStateId",
      "value": "parallel-approved-state"
    }
  ],
  "item": [
    {
      "name": "üèóÔ∏è Setup - Parallel Document Review Workflow",
      "item": [
        {
          "name": "1. Create Parallel Document Process",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Parallel Document Review\",\n  \"code\": \"PARALLEL_DOC_REVIEW\",\n  \"description\": \"Document review with parallel technical and legal review\",\n  \"version\": \"1.0\",\n  \"sla\": 864000\n}"
            },
            "url": {"raw": "{{baseUrl}}/process", "host": ["{{baseUrl}}"], "path": ["process"]}
          },
          "description": "Creates the main parallel workflow process"
        },
        {
          "name": "2. Create APPLIED State (Initial)",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"APPLIED\",\n  \"name\": \"Document Submitted\",\n  \"description\": \"Document submitted for parallel review\",\n  \"sla\": 86400,\n  \"isInitial\": true\n}"
            },
            "url": {"raw": "{{baseUrl}}/process/{{parallelProcessId}}/state", "host": ["{{baseUrl}}"], "path": ["process", "{{parallelProcessId}}", "state"]}
          },
          "description": "Initial state for document submission"
        },
        {
          "name": "3. Create PARALLEL_REVIEW State",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"PARALLEL_REVIEW\",\n  \"name\": \"Parallel Review\",\n  \"description\": \"Parallel technical and legal review\",\n  \"sla\": 172800,\n  \"isParallel\": true,\n  \"branchStates\": [\"TECHNICAL_REVIEW\", \"LEGAL_REVIEW\"]\n}"
            },
            "url": {"raw": "{{baseUrl}}/process/{{parallelProcessId}}/state", "host": ["{{baseUrl}}"], "path": ["process", "{{parallelProcessId}}", "state"]}
          },
          "description": "Parallel state with two branches"
        },
        {
          "name": "4. Create TECHNICAL_REVIEW State",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"TECHNICAL_REVIEW\",\n  \"name\": \"Technical Review\",\n  \"description\": \"Technical review branch\",\n  \"sla\": 86400\n}"
            },
            "url": {"raw": "{{baseUrl}}/process/{{parallelProcessId}}/state", "host": ["{{baseUrl}}"], "path": ["process", "{{parallelProcessId}}", "state"]}
          },
          "description": "Technical review branch state"
        },
        {
          "name": "5. Create LEGAL_REVIEW State",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"LEGAL_REVIEW\",\n  \"name\": \"Legal Review\",\n  \"description\": \"Legal review branch\",\n  \"sla\": 86400\n}"
            },
            "url": {"raw": "{{baseUrl}}/process/{{parallelProcessId}}/state", "host": ["{{baseUrl}}"], "path": ["process", "{{parallelProcessId}}", "state"]}
          },
          "description": "Legal review branch state"
        },
        {
          "name": "6. Create JOIN_REVIEW State",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"JOIN_REVIEW\",\n  \"name\": \"Join Review\",\n  \"description\": \"Join state after parallel reviews\",\n  \"sla\": 43200,\n  \"isJoin\": true\n}"
            },
            "url": {"raw": "{{baseUrl}}/process/{{parallelProcessId}}/state", "host": ["{{baseUrl}}"], "path": ["process", "{{parallelProcessId}}", "state"]}
          },
          "description": "Join state after parallel branches complete"
        },
        {
          "name": "7. Create APPROVED State",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"APPROVED\",\n  \"name\": \"Document Approved\",\n  \"description\": \"Document approved after parallel review\",\n  \"sla\": 21600\n}"
            },
            "url": {"raw": "{{baseUrl}}/process/{{parallelProcessId}}/state", "host": ["{{baseUrl}}"], "path": ["process", "{{parallelProcessId}}", "state"]}
          },
          "description": "Final approved state"
        }
      ]
    },
    {
      "name": "üîß Setup - Actions for Parallel Workflow",
      "item": [
        {
          "name": "1. Submit for Review Action",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Submit for Review\",\n  \"nextState\": \"{{parallelStateId}}\",\n  \"attributeValidation\": {\n    \"attributes\": {\n      \"roles\": [\"CITIZEN\", \"ADMIN\"]\n    },\n    \"assigneeCheck\": false\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/state/{{appliedStateId}}/action", "host": ["{{baseUrl}}"], "path": ["state", "{{appliedStateId}}", "action"]}
          },
          "description": "Action to start parallel review"
        },
        {
          "name": "2. Complete Technical Review Action",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Complete Technical Review\",\n  \"nextState\": \"{{joinStateId}}\",\n  \"attributeValidation\": {\n    \"attributes\": {\n      \"roles\": [\"TECHNICAL_REVIEWER\"]\n    },\n    \"assigneeCheck\": false\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/state/TECHNICAL_REVIEW_STATE_ID/action", "host": ["{{baseUrl}}"], "path": ["state", "TECHNICAL_REVIEW_STATE_ID", "action"]}
          },
          "description": "Action to complete technical review branch"
        },
        {
          "name": "3. Complete Legal Review Action",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Complete Legal Review\",\n  \"nextState\": \"{{joinStateId}}\",\n  \"attributeValidation\": {\n    \"attributes\": {\n      \"roles\": [\"LEGAL_REVIEWER\"]\n    },\n    \"assigneeCheck\": false\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/state/LEGAL_REVIEW_STATE_ID/action", "host": ["{{baseUrl}}"], "path": ["state", "LEGAL_REVIEW_STATE_ID", "action"]}
          },
          "description": "Action to complete legal review branch"
        },
        {
          "name": "4. Approve Document Action",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Approve Document\",\n  \"nextState\": \"{{approvedStateId}}\",\n  \"attributeValidation\": {\n    \"attributes\": {\n      \"roles\": [\"ADMIN\", \"SUPERVISOR\"]\n    },\n    \"assigneeCheck\": false\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/state/{{joinStateId}}/action", "host": ["{{baseUrl}}"], "path": ["state", "{{joinStateId}}", "action"]}
          },
          "description": "Action to approve after join"
        }
      ]
    },
    {
      "name": "üîÑ Test - Complete Parallel Workflow Flow",
      "item": [
        {
          "name": "Step 1: Submit Document for Parallel Review",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-001\",\n  \"action\": \"Submit for Review\",\n  \"comment\": \"Submitting document for parallel technical and legal review\",\n  \"attributes\": {\n    \"roles\": [\"CITIZEN\", \"ADMIN\"],\n    \"document_type\": [\"CONTRACT\"],\n    \"priority\": [\"HIGH\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "üéØ Should create parallel branches: TECHNICAL_REVIEW and LEGAL_REVIEW"
        },
        {
          "name": "Step 2: Complete Technical Review Branch",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "technical-reviewer"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-001\",\n  \"action\": \"Complete Technical Review\",\n  \"comment\": \"Technical review completed - all requirements met\",\n  \"attributes\": {\n    \"roles\": [\"TECHNICAL_REVIEWER\"],\n    \"technical_approval\": [\"APPROVED\"],\n    \"review_notes\": [\"All technical requirements satisfied\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "üéØ Should complete TECHNICAL_REVIEW branch and wait for LEGAL_REVIEW"
        },
        {
          "name": "Step 3: Complete Legal Review Branch",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "legal-reviewer"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-001\",\n  \"action\": \"Complete Legal Review\",\n  \"comment\": \"Legal review completed - contract terms acceptable\",\n  \"attributes\": {\n    \"roles\": [\"LEGAL_REVIEWER\"],\n    \"legal_approval\": [\"APPROVED\"],\n    \"legal_notes\": [\"Contract terms comply with regulations\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "üéØ Should complete LEGAL_REVIEW branch and trigger join to JOIN_REVIEW"
        },
        {
          "name": "Step 4: Approve Document After Join",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-001\",\n  \"action\": \"Approve Document\",\n  \"comment\": \"Both reviews completed - approving document\",\n  \"attributes\": {\n    \"roles\": [\"ADMIN\"],\n    \"final_approval\": [\"APPROVED\"],\n    \"approval_reason\": [\"Both technical and legal reviews passed\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "üéØ Should transition to final APPROVED state"
        }
      ]
    },
    {
      "name": "üìä Monitor - Parallel Workflow Status",
      "item": [
        {
          "name": "Get Complete History (Parallel Flow)",
          "request": {
            "method": "GET",
            "header": [{"key": "X-Tenant-ID", "value": "{{tenantId}}"}],
            "url": {
              "raw": "{{baseUrl}}/transition?entityId=parallel-doc-001&processId={{parallelProcessId}}&history=true",
              "host": ["{{baseUrl}}"],
              "path": ["transition"],
              "query": [
                {"key": "entityId", "value": "parallel-doc-001"},
                {"key": "processId", "value": "{{parallelProcessId}}"},
                {"key": "history", "value": "true"}
              ]
            }
          },
          "description": "üìà Should show: APPLIED ‚Üí PARALLEL_REVIEW (with branches) ‚Üí JOIN_REVIEW ‚Üí APPROVED"
        },
        {
          "name": "Get Latest Status (Parallel Flow)",
          "request": {
            "method": "GET",
            "header": [{"key": "X-Tenant-ID", "value": "{{tenantId}}"}],
            "url": {
              "raw": "{{baseUrl}}/transition?entityId=parallel-doc-001&processId={{parallelProcessId}}&history=false",
              "host": ["{{baseUrl}}"],
              "path": ["transition"],
              "query": [
                {"key": "entityId", "value": "parallel-doc-001"},
                {"key": "processId", "value": "{{parallelProcessId}}"},
                {"key": "history", "value": "false"}
              ]
            }
          },
          "description": "üìà Should show latest instance in APPROVED state"
        }
      ]
    },
    {
      "name": "üîç Test - Parallel Branch Isolation",
      "item": [
        {
          "name": "Test: Submit New Document for Parallel Review",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-002\",\n  \"action\": \"Submit for Review\",\n  \"comment\": \"Second document for parallel review testing\",\n  \"attributes\": {\n    \"roles\": [\"CITIZEN\", \"ADMIN\"],\n    \"document_type\": [\"AGREEMENT\"],\n    \"priority\": [\"MEDIUM\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "üéØ Should create separate parallel branches for new entity"
        },
        {
          "name": "Test: Complete Only Technical Review (Leave Legal Pending)",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "technical-reviewer"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-002\",\n  \"action\": \"Complete Technical Review\",\n  \"comment\": \"Only technical review completed\",\n  \"attributes\": {\n    \"roles\": [\"TECHNICAL_REVIEWER\"],\n    \"technical_approval\": [\"APPROVED\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "üéØ Should complete TECHNICAL_REVIEW but wait for LEGAL_REVIEW"
        },
        {
          "name": "Check Status: Should Still Be In Progress",
          "request": {
            "method": "GET",
            "header": [{"key": "X-Tenant-ID", "value": "{{tenantId}}"}],
            "url": {
              "raw": "{{baseUrl}}/transition?entityId=parallel-doc-002&processId={{parallelProcessId}}&history=false",
              "host": ["{{baseUrl}}"],
              "path": ["transition"],
              "query": [
                {"key": "entityId", "value": "parallel-doc-002"},
                {"key": "processId", "value": "{{parallelProcessId}}"},
                {"key": "history", "value": "false"}
              ]
            }
          },
          "description": "üìà Should show parallel execution still in progress (1/2 branches complete)"
        }
      ]
    },
    {
      "name": "üö´ Test - Parallel Workflow Error Scenarios",
      "item": [
        {
          "name": "Error: Try to Complete Non-Existent Branch",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "test-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-001\",\n  \"action\": \"Invalid Branch Action\",\n  \"comment\": \"This should fail\",\n  \"attributes\": {\n    \"roles\": [\"CITIZEN\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "‚ùå Should return 400 - action not valid for current state"
        },
        {
          "name": "Error: Try to Approve Before Join Complete",
          "request": {
            "method": "POST",
            "header": [
              {"key": "Content-Type", "value": "application/json"},
              {"key": "X-Tenant-ID", "value": "{{tenantId}}"},
              {"key": "X-Client-Id", "value": "admin-user"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"processId\": \"{{parallelProcessId}}\",\n  \"entityId\": \"parallel-doc-002\",\n  \"action\": \"Approve Document\",\n  \"comment\": \"This should fail - not all branches complete\",\n  \"attributes\": {\n    \"roles\": [\"ADMIN\"]\n  }\n}"
            },
            "url": {"raw": "{{baseUrl}}/transition", "host": ["{{baseUrl}}"], "path": ["transition"]}
          },
          "description": "‚ùå Should return 400 - cannot approve before all branches complete"
        }
      ]
    }
  ]
} 